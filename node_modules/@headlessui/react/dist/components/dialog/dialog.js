"use client";import l,{createContext as me,createRef as De,useContext as Y,useEffect as ce,useMemo as _,useReducer as Pe,useRef as J,useState as ye}from"react";import{useEvent as D}from'../../hooks/use-event.js';import{useEventListener as Ee}from'../../hooks/use-event-listener.js';import{useId as L}from'../../hooks/use-id.js';import{useInertOthers as Ce}from'../../hooks/use-inert-others.js';import{useIsTouchDevice as Ae}from'../../hooks/use-is-touch-device.js';import{useOnDisappear as _e}from'../../hooks/use-on-disappear.js';import{useOutsideClick as Fe}from'../../hooks/use-outside-click.js';import{useOwnerDocument as Re}from'../../hooks/use-owner.js';import{useRootContainers as be}from'../../hooks/use-root-containers.js';import{useScrollLock as Se}from'../../hooks/use-scroll-lock.js';import{useServerHandoffComplete as ve}from'../../hooks/use-server-handoff-complete.js';import{useSyncRefs as h}from'../../hooks/use-sync-refs.js';import{CloseProvider as xe}from'../../internal/close-provider.js';import{HoistFormFields as Le}from'../../internal/form-fields.js';import{State as F,useOpenClosed as he}from'../../internal/open-closed.js';import{ForcePortalRoot as X}from'../../internal/portal-force-root.js';import{StackMessage as B,StackProvider as Oe}from'../../internal/stack-context.js';import{match as O}from'../../utils/match.js';import{RenderFeatures as K,forwardRefWithAs as I,render as w}from'../../utils/render.js';import{Description as V,useDescriptions as Ie}from'../description/description.js';import{FocusTrap as we,FocusTrapFeatures as g}from'../focus-trap/focus-trap.js';import{Keys as Me}from'../keyboard.js';import{Portal as q,useNestedPortals as Ge}from'../portal/portal.js';var He=(r=>(r[r.Open=0]="Open",r[r.Closed=1]="Closed",r))(He||{}),Ne=(t=>(t[t.SetTitleId=0]="SetTitleId",t))(Ne||{});let ke={[0](o,t){return o.titleId===t.id?o:{...o,titleId:t.id}}},R=me(null);R.displayName="DialogContext";function M(o){let t=Y(R);if(t===null){let r=new Error(`<${o} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,M),r}return t}function Ue(o,t){return O(t.type,ke,o,t)}let $e="div",je=K.RenderStrategy|K.Static;function We(o,t){let r=L(),{id:u=`headlessui-dialog-${r}`,open:i,onClose:s,initialFocus:d,role:a="dialog",autoFocus:c=!0,__demoMode:T=!1,...G}=o,[b,H]=ye(0),N=J(!1);a=function(){return a==="dialog"||a==="alertdialog"?a:(N.current||(N.current=!0,console.warn(`Invalid role [${a}] passed to <Dialog />. Only \`dialog\` and and \`alertdialog\` are supported. Using \`dialog\` instead.`)),"dialog")}();let P=he();i===void 0&&P!==null&&(i=(P&F.Open)===F.Open);let p=J(null),z=h(p,t),y=Re(p),k=o.hasOwnProperty("open")||P!==null,U=o.hasOwnProperty("onClose");if(!k&&!U)throw new Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!k)throw new Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!U)throw new Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(typeof i!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${i}`);if(typeof s!="function")throw new Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${s}`);let n=i?0:1,[E,Q]=Pe(Ue,{titleId:null,descriptionId:null,panelRef:De()}),m=D(()=>s(!1)),$=D(e=>Q({type:0,id:e})),S=ve()?n===0:!1,C=b>1,Z=Y(R)!==null,[ee,te]=Ge(),oe={get current(){var e;return(e=E.panelRef.current)!=null?e:p.current}},{resolveContainers:v,mainTreeNodeRef:re,MainTreeNode:le}=be({portals:ee,defaultContainers:[oe]}),ne=C?"parent":"leaf",j=P!==null?(P&F.Closing)===F.Closing:!1,ae=(()=>C||j?!1:S)();Ce({allowed:D(()=>{var e,f;return[(f=(e=p.current)==null?void 0:e.closest("[data-headlessui-portal]"))!=null?f:null]}),disallowed:D(()=>{var e,f;return[(f=(e=re.current)==null?void 0:e.closest("body > *:not(#headlessui-portal-root)"))!=null?f:null]})},T?!1:ae);let ie=(()=>!(!S||C))();Fe(v,e=>{e.preventDefault(),m()},ie);let se=(()=>!(C||n!==0))();Ee(y==null?void 0:y.defaultView,"keydown",e=>{se&&(e.defaultPrevented||e.key===Me.Escape&&(e.preventDefault(),e.stopPropagation(),m()))});let pe=(()=>!(j||n!==0||Z))();Se(y,T?!1:pe,v),_e(p,m,n===0);let[ue,de]=Ie(),fe=_(()=>[{dialogState:n,close:m,setTitleId:$},E],[n,E,m,$]),W=_(()=>({open:n===0}),[n]),ge={ref:z,id:u,role:a,tabIndex:-1,"aria-modal":n===0?!0:void 0,"aria-labelledby":E.titleId,"aria-describedby":ue},Te=!Ae(),A=S?O(ne,{parent:g.RestoreFocus,leaf:g.All&~g.FocusLock}):g.None;return c&&(A|=g.AutoFocus),Te||(A&=~g.InitialFocus),T&&(A=g.None),l.createElement(Oe,{type:"Dialog",enabled:n===0,element:p,onUpdate:D((e,f)=>{f==="Dialog"&&O(e,{[B.Add]:()=>H(x=>x+1),[B.Remove]:()=>H(x=>x-1)})})},l.createElement(X,{force:!0},l.createElement(q,null,l.createElement(R.Provider,{value:fe},l.createElement(q.Group,{target:p},l.createElement(X,{force:!1},l.createElement(de,{slot:W,name:"Dialog.Description"},l.createElement(te,null,l.createElement(we,{initialFocus:d,initialFocusFallback:p,containers:v,features:A},l.createElement(xe,{value:m},w({ourProps:ge,theirProps:G,slot:W,defaultTag:$e,features:je,visible:n===0,name:"Dialog"})))))))))),l.createElement(Le,null,l.createElement(le,null)))}let Ye="div";function Je(o,t){let r=L(),{id:u=`headlessui-dialog-panel-${r}`,...i}=o,[{dialogState:s},d]=M("Dialog.Panel"),a=h(t,d.panelRef),c=_(()=>({open:s===0}),[s]),T=D(b=>{b.stopPropagation()});return w({ourProps:{ref:a,id:u,onClick:T},theirProps:i,slot:c,defaultTag:Ye,name:"Dialog.Panel"})}let Xe="h2";function Be(o,t){let r=L(),{id:u=`headlessui-dialog-title-${r}`,...i}=o,[{dialogState:s,setTitleId:d}]=M("Dialog.Title"),a=h(t);ce(()=>(d(u),()=>d(null)),[u,d]);let c=_(()=>({open:s===0}),[s]);return w({ourProps:{ref:a,id:u},theirProps:i,slot:c,defaultTag:Xe,name:"Dialog.Title"})}let Ke=I(We),Ve=I(Je),qe=I(Be),At=V,_t=Object.assign(Ke,{Panel:Ve,Title:qe,Description:V});export{_t as Dialog,At as DialogDescription,Ve as DialogPanel,qe as DialogTitle};
